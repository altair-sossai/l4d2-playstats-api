# Left 4 Dead 2 Match Data API

## Overview

This project is an Azure Function v4 .NET Isolated (net8.0) application designed to store, process, and provide data from Left 4 Dead 2 matches. The data is generated using the [l4d2_playstats](https://github.com/SirPlease/L4D2-Competitive-Rework/blob/master/addons/sourcemod/plugins/optional/l4d2_playstats.smx) plugin.

To upload the data generated by the l4d2_playstats plugin to the API, you can use the [l4d2_playstats_sync](https://github.com/altair-sossai/l4d2-zone-server/blob/master/addons/sourcemod/plugins/optional/l4d2_playstats_sync.smx) plugin.

The API leverages the [L4D2PlayStats](https://www.nuget.org/packages/L4D2PlayStats) NuGet package to process the data generated by the l4d2_playstats plugin and makes it available through C# objects.

## Endpoints

### Matches
- `MatchesFunction_MatchesAsync`: Retrieves all competitive matches for a specific server.
  - **[GET]** `http://localhost:7094/api/matches/{serverId}`
- `MatchesFunction_MatchesBetweenAsync`: Retrieves competitive matches for a specific server within a date range.
  - **[GET]** `http://localhost:7094/api/matches/{serverId}/between/{start}/and/{end}`

### Mix
- `MixFunction_MixAsync`: Generates a mix of players for a new game based on the ranking.
  - **[POST]** `http://localhost:7094/api/mix`

### Ranking
- `RankingFunction_RankingAsync`: Retrieves the ranking for a specific server.
  - **[GET]** `http://localhost:7094/api/ranking/{serverId}`
- `RankingFunction_ConfigAsync`: Retrieves the ranking configuration.
  - **[GET]** `http://localhost:7094/api/ranking-config`

### Server
- `ServerFunction_Servers`: Retrieves information about all configured servers.
  - **[GET]** `http://localhost:7094/api/servers`
- `ServerFunction_Server`: Retrieves information about a specific server.
  - **[GET]** `http://localhost:7094/api/servers/{serverId}`

### Statistics
- `StatisticsFunction_AddOrUpdate`: Adds or updates statistics.
  - **[POST]** `http://localhost:7094/api/statistics`
- `StatisticsFunction_GetStatisticAsync`: Retrieves a specific statistic for a server.
  - **[GET]** `http://localhost:7094/api/statistics/{serverId}/{statisticId}`
- `StatisticsFunction_GetStatisticsAsync`: Retrieves all statistics for a server.
  - **[GET]** `http://localhost:7094/api/statistics/{serverId}`
- `StatisticsFunction_GetStatisticsBetweenAsync`: Retrieves statistics for a server within a date range.
  - **[GET]** `http://localhost:7094/api/statistics/{serverId}/between/{start}/and/{end}`

## Data Types

- **Statistics**: Generated by the l4d2_playstats plugin without processing.
- **Server**: Configured servers; multiple servers can be managed simultaneously.
- **Ranking**: Endpoints that generate player rankings based on statistics.
- **Mix**: Endpoint to generate a mix of players for a new game, using the ranking as a basis.
- **Matches**: Competitive matches endpoints; the API processes statistics data and only provides matches classified as competitive.

## Creating an Azure Function

### Prerequisites
- An active Azure subscription.
- [Azure CLI](https://docs.microsoft.com/en-us/cli/azure/install-azure-cli) installed on your local machine.
- [Visual Studio 2022](https://visualstudio.microsoft.com/) with Azure development workload installed.
- [.NET 8.0 SDK](https://dotnet.microsoft.com/download/dotnet/8.0) installed.

### Steps

1. **Log in to Azure**
   ```bash
   az login
   ```

2. **Create a Resource Group**
   ```bash
   az group create --name <ResourceGroupName> --location <Location>
   ```

3. **Create a Storage Account**
   ```bash
   az storage account create --name <StorageAccountName> --location <Location> --resource-group <ResourceGroupName> --sku Standard_LRS
   ```

4. **Create a Function App**
   ```bash
   az functionapp create --resource-group <ResourceGroupName> --consumption-plan-location <Location> --runtime dotnet-isolated --functions-version 4 --name <FunctionAppName> --storage-account <StorageAccountName>
   ```

5. **Deploy the Function App**
   - Open your project in Visual Studio.
   - Right-click the project in Solution Explorer and select **Publish**.
   - Follow the prompts to publish the function app to Azure.

### Dependency

The only dependency for this project is an Azure Storage Account, which is used to store match information.

## Additional Resources

- [Azure Functions Documentation](https://docs.microsoft.com/en-us/azure/azure-functions/)
- [Azure Storage Account Documentation](https://docs.microsoft.com/en-us/azure/storage/common/storage-account-overview)
- [L4D2PlayStats NuGet Package](https://www.nuget.org/packages/L4D2PlayStats)
